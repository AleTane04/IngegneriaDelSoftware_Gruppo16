@startuml
' Stile conforme alla Slide 13 (Diagrammi di Interazione)
skinparam style strictuml
skinparam sequenceArrowThickness 1.5
skinparam roundcorner 5
skinparam maxmessagesize 150
skinparam sequenceParticipant underline

' Definizione Partecipanti
actor "Bibliotecario" as User
participant ":PrestitiView" as View
participant ":PrestitiController" as Controller
participant ":Biblioteca" as Service
participant "p:Prestito" as Prestito

' --- INIZIO FLUSSO ---
Note over User, View : Il bibliotecario accede alla sezione "Prestiti"

User -> View : Apre la scheda "Monitoraggio"
activate View

    View -> Controller : initialize()
    activate Controller

        ' Recupero dati
        Controller -> Service : getPrestitiAttivi()
        activate Service
            
            ' Logica di Ordinamento (IF-3.1)
            Note right of Service : Ordina per data scadenza (asc)
            Service -> Service : sort(listaPrestiti)
            
            Service --> Controller : listaOrdinata
        deactivate Service

        ' Passaggio dati alla View
        Controller -> View : visualizzaPrestiti(listaOrdinata)
        
        ' --- CICLO DI RENDERING (UI-1.4) ---
        Note right of View : Generazione righe tabella
        
        loop [per ogni prestito p nella lista]
            
            View -> Prestito : isScaduto(dataOggi)
            activate Prestito
            Prestito --> View : true/false
            deactivate Prestito
            
            opt [Ã¨ scaduto]
                View -> View : setStileRiga("rosso")
                Note right of View : Evidenzia ritardo
            end
            
        end

        View --> User : Mostra elenco aggiornato

    deactivate Controller
deactivate View

@enduml