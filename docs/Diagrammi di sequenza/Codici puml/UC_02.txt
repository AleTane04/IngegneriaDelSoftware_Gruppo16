@startuml
' Stile conforme alla Slide 13 (Diagrammi di Interazione)
skinparam style strictuml
skinparam sequenceArrowThickness 1.5
skinparam roundcorner 5
skinparam maxmessagesize 150
skinparam sequenceParticipant underline

' Definizione Partecipanti
actor "Bibliotecario" as User
participant ":LibriView" as View
participant ":LibriController" as Controller
participant ":Biblioteca" as Service
participant "l:Libro" as Libro

' --- FASE 1: PREPARAZIONE MODIFICA ---
Note over User, View : Il bibliotecario seleziona un libro dalla tabella

User -> View : Clicca su "Modifica"
activate View
    View -> Controller : handleRichiestaModifica()
    activate Controller
        
        Controller -> View : l_selezionato = getLibroSelezionato()
        
        ' Popolamento campi e blocco ISBN (Requisito FC-4)
        Controller -> View : setTitolo(l_selezionato.getTitolo())
        Controller -> View : setAutori(l_selezionato.getAutori())
        Controller -> View : setIsbn(l_selezionato.getIsbn())
        Controller -> View : setDisableIsbnField(true)
        
        Controller --> View : mostraFormModifica()
    deactivate Controller
deactivate View

' --- FASE 2: CONFERMA E SALVATAGGIO ---
User -> View : Modifica i campi e clicca "Salva"
activate View
    View -> Controller : handleSalvaModifiche()
    activate Controller

        ' Recupero dati modificati
        Controller -> View : nuovoTitolo = getTitolo()
        Controller -> View : nuoviAutori = getAutori()
        Controller -> View : anno = getAnno()
        Controller -> View : isbn = getIsbn() 

        ' Chiamata al Service per aggiornamento
        Controller -> Service : aggiornaLibro(isbn, nuovoTitolo, nuoviAutori, ...)
        activate Service
            
            ' Recupero istanza specifica dal modello
            Service -> Service : l = getLibro(isbn)
            
            ' Aggiornamento stato oggetto (Model)
            Service -> Libro : setTitolo(nuovoTitolo)
            activate Libro
            deactivate Libro
            
            Service -> Libro : setAutori(nuoviAutori)
            activate Libro
            deactivate Libro
            
            Service -> Libro : setAnno(anno)
            activate Libro
            deactivate Libro

            ' Persistenza delle modifiche (FC-1)
            Service -> Service : salvaLibri()
            
            Service --> Controller : conferma
            
            Controller -> View : aggiornaTabellaLibri()
            View --> User : Mostra messaggio successo

        deactivate Service
    deactivate Controller
deactivate View

@enduml