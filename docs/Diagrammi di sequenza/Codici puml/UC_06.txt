@startuml
' Stile conforme alla Slide 13 (Diagrammi di Interazione)
skinparam style strictuml
skinparam sequenceArrowThickness 1.5
skinparam roundcorner 5
skinparam maxmessagesize 150
skinparam sequenceParticipant underline

' Definizione Partecipanti
actor "Bibliotecario" as User
participant ":UtentiView" as View
participant ":UtentiController" as Controller
participant ":Biblioteca" as Service
participant "u:Utente" as Utente

' --- FASE 1: PREPARAZIONE MODIFICA ---
Note over User, View : Il bibliotecario seleziona un utente dalla tabella

User -> View : Clicca su "Modifica"
activate View
    View -> Controller : handleRichiestaModifica()
    activate Controller
        
        Controller -> View : u_selezionato = getUtenteSelezionato()
        
        ' Popolamento campi e blocco Matricola (Requisito FC-6.1)
        Controller -> View : setNome(u_selezionato.getNome())
        Controller -> View : setCognome(u_selezionato.getCognome())
        Controller -> View : setMatricola(u_selezionato.getMatricola())
        Controller -> View : setEmail(u_selezionato.getEmail())
        
        Note right of View : La matricola Ã¨ immutabile
        Controller -> View : setDisableMatricolaField(true)
        
        Controller --> View : mostraFormModifica()
    deactivate Controller
deactivate View

' --- FASE 2: CONFERMA E SALVATAGGIO ---
User -> View : Modifica i campi e clicca "Salva"
activate View
    View -> Controller : handleSalvaModifiche()
    activate Controller

        ' Recupero dati modificati (Matricola serve come chiave di ricerca)
        Controller -> View : nuovoNome = getNome()
        Controller -> View : nuovoCognome = getCognome()
        Controller -> View : nuovaEmail = getEmail()
        Controller -> View : matricola = getMatricola()

        ' Chiamata al Service per aggiornamento
        Controller -> Service : aggiornaUtente(matricola, nuovoNome, ...)
        activate Service
            
            ' Recupero istanza specifica dal modello
            Service -> Service : u = getUtente(matricola)
            
            ' Aggiornamento stato oggetto (Model)
            Service -> Utente : setNome(nuovoNome)
            activate Utente
            deactivate Utente
            
            Service -> Utente : setCognome(nuovoCognome)
            activate Utente
            deactivate Utente
            
            Service -> Utente : setEmail(nuovaEmail)
            activate Utente
            deactivate Utente

            ' Persistenza delle modifiche (FC-1)
            Service -> Service : salvaUtenti()
            
            Service --> Controller : conferma
            
            Controller -> View : aggiornaTabellaUtenti()
            View --> User : Mostra messaggio successo

        deactivate Service
    deactivate Controller
deactivate View

@enduml